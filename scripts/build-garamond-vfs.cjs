/**
 * Script de génération du VFS (Virtual File System) pour les polices Garamond
 *
 * Ce script lit les fichiers de polices TTF et les encode en base64
 * pour créer un fichier TypeScript importable par pdfmake.
 *
 * Usage: node scripts/build-garamond-vfs.cjs
 */

const fs = require('fs');
const path = require('path');

const fontsDir = path.join(__dirname, '../src/assets/fonts');
const outputFile = path.join(__dirname, '../src/lib/garamond-vfs.ts');

const fonts = [
  'EBGaramond-Regular.ttf',
  'EBGaramond-Bold.ttf',
  'EBGaramond-Italic.ttf',
  'EBGaramond-BoldItalic.ttf'
];

console.log('Building Garamond VFS...');
console.log('Fonts directory:', fontsDir);

const vfs = {};
let totalSize = 0;

for (const font of fonts) {
  const fontPath = path.join(fontsDir, font);

  if (!fs.existsSync(fontPath)) {
    console.error(`Font file not found: ${fontPath}`);
    process.exit(1);
  }

  const fontData = fs.readFileSync(fontPath);
  const base64 = fontData.toString('base64');
  vfs[font] = base64;

  totalSize += fontData.length;
  console.log(`  ${font}: ${fontData.length} bytes -> ${base64.length} base64 chars`);
}

const output = `// Auto-generated by: node scripts/build-garamond-vfs.cjs
// Do not edit manually - regenerate with: npm run build:fonts

/**
 * Virtual File System contenant les polices EB Garamond encodées en base64
 * Ces données sont utilisées par pdfmake pour générer des PDFs avec Garamond
 */
export const garamondVfs: Record<string, string> = ${JSON.stringify(vfs, null, 2)};

/**
 * Configuration des polices Garamond pour pdfmake
 */
export const garamondFonts = {
  Garamond: {
    normal: 'EBGaramond-Regular.ttf',
    bold: 'EBGaramond-Bold.ttf',
    italics: 'EBGaramond-Italic.ttf',
    bolditalics: 'EBGaramond-BoldItalic.ttf'
  }
};
`;

fs.writeFileSync(outputFile, output);

console.log('');
console.log('VFS Garamond generated successfully!');
console.log(`  Output: ${outputFile}`);
console.log(`  Total font size: ${(totalSize / 1024).toFixed(1)} KB`);
console.log(`  Base64 output size: ${(output.length / 1024).toFixed(1)} KB`);
